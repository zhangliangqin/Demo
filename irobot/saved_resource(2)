KISSY.add("mui/minicart/minicart",function(t,a,e,i,n,r,o){var s={},c=0;return t.mix(s,{"version":"%VERSION%","init":function(i,n){if(!c){c++;var o=this;o.carttype=1,i=a.get(i),n=t.merge({},n),a.addClass(i,"tm-mCart"),o.el=i;var s=function(){i.innerHTML='<div class="tm-mcRoot"><div class="tm-mcListBox"><div class="tm-mcListInner"><div class="tm-mcList"></div></div><div class="tm-mcLoading"></div><div class="tm-mcMask"></div></div><div class="tm-mcHandler"><div class="tm-mcApart"></div><div class="tm-mcGrace"></div></div></div>',o.handlerEl=a.get("div.tm-mcHandler",i),o.listBoxEl=a.get("div.tm-mcListBox",i),o.listInnerEl=a.get("div.tm-mcListInner",i),o.listEl=a.get("div.tm-mcList",i),o.rootEl=a.get("div.tm-mcRoot",i),o.graceEl=a.get("div.tm-mcGrace",i),o.apartEl=a.get("div.tm-mcApart",i),o.renderHandler(),t.use("mui/minicart/fullext",function(){o.strectch()}),e.on(o.rootEl,"click",function(t){t.stopPropagation();for(var e=t.target;;){if(e===this)return;var i=a.attr(e,"data-tmc");if("."===i)return;if(i)return"A"===e.nodeName&&t.preventDefault(),o[i](e);e=a.parent(e)}}),r.detach("numInit",s)};r.on("numInit",s),r.numInit(),o.CartModel=r}},"login":function(a){var e=this;r.record("tmalljy.2.5?action=openmininotlogin_v102&ver="+e.carttype);var i=r.get("_mallbarItem"),n=r.get("_mallbarConf");i&&n&&i.fire(n.E.LOGIN,{"success":function(){return r.set("_isLogin",!0),t.isFunction(a)?a():void(TB&&TB.Global&&TB.Global.writeLoginInfo&&(TB._isMemberInfoReady=!1,TB._isLoginStatusReady=!1,TB.Global.writeLoginInfo()))}})},"cart":function(){window.open(r.getApi("bcart"),"_blank")},"add":function(e,i,n){var o=this;o.addData={"params":t.clone(e),"success":i,"error":n};var s=e.anim;delete e.anim,i=i||function(){},r.set("_cached",!1),r.add({"data":e,"success":function(t){if(window.TB&&TB.Global&&TB.Global.mallbar){var n=s.startNode,r=40,o=40;TB.Global.mallbar.driving({"e":{"target":s.startNode,"pageX":a.offset(n).left+(a.width(n)-r)/2,"pageY":a.offset(n).top-o},"type":"cart","flyer":s.img,"width":r,"height":o,"params":e,"speed":2,"callback":function(){i(t)}})}},"error":n||i})},"invalidCache":function(){r.set("_cached",!1)},"loginThenAdd":function(){var t=this;t.login(function(){var a=t.addData;t.add(a.params,a.success,a.error)})},"renderHandler":function(){function t(){var t="";return r.get("isDouble11Pre")&&(t='<div class="tianmaobao j_tianmaobao"><a href="//chong.alipay.com/i/chong.htm" title="\u5929\u732b\u5b9d"><img src="//gtms01.alicdn.com/tps/i1/TB1p6vmGpXXXXXPXFXXYZaeLVXX-280-46.png"/></a></div>'),t}function e(){var t="",a=r.get("tmallEppCart");return a&&(t+='<a class="tmallEppCart" href="'+a+'" title="\u8fdb\u5165\u4f01\u4e1a\u91c7\u8d2d\u8d2d\u7269\u8f66">',t+='<img class="icon" src="//img.alicdn.com/tfs/TB1Ah_CKFXXXXXHXVXXXXXXXXXX-78-78.png"/>',t+="<span>\u8fdb\u5165\u4f01\u4e1a\u91c7\u8d2d\u8d2d\u7269\u8f66</span>",t+='<img class="arrow" src="//img.alicdn.com/tfs/TB1ZiDGKFXXXXccXFXXXXXXXXXX-14-22.png"/>',t+="</a>"),t}var i=this,n=r.getNum("total"),s="";r.get("_listFilled")&&!i.cartDegr&&(s+='<div class="tm-mcCashier-wrap">',s+=t(),s+=e(),s+='<div class="tm-mcTotal clearfix"><h3><span class="tm-e1">\u8d2d\u7269\u8f66</span><span class="tm-e2">\u5df2\u9009</span><strong class="tm-mcCartNumTotal">'+n+'</strong><strong class="tm-mcCheckedNum">'+(r.get("_checkedCount")||0)+'</strong><span class="tm-e2">\u4ef6</span></h3><span class="tm-mcTotalFeeWrap"><strong class="tm-mcTotalFee">'+o.toMoney(r.get("_totalFee"),r.get("_totalCurrency"))+"</strong></span></div>",s+='<div class="tm-mcCashier" data-tmc="go">',s+='<div class="tm-mcGo">\u7ed3 \u7b97<s></s></div>',s+="</div>",s+="</div>");var c=i.handlerEl;a.remove(".tm-mcCashier-wrap",c),a.append(a.create(s),c)}}),r.on("after_counterDownChange",function(t){a[t.newVal?"addClass":"removeClass"](s.el,"tm-mcCounterDown")}),r.on("after_countMaxChange",function(t){a[t.newVal?"addClass":"removeClass"](s.el,"tm-mcCountMax")}),window.MiniCartModel=r,window.TMiniCart=s,s},{"requires":["dom","event","anim","ua","mui/minicart/model","mui/minicart/util","mui/minicart/minicart.css"]});KISSY.add("mui/minicart/model",function(t,e,a,r,i,n,c){function s(){var t=this,e=location.hostname,a=e.match(/\b(daily|com\.hk)\b/),r=e.match(/\.hk\b/),i=e.match(/\.95095/),n=e.match(/\.liangxinyao/),c=e.match(/\.95095\.daily\.etao\.net/);t.isDaily=a;var o=a?"daily.tmall.com.hk":"tmall.hk",l=a?"daily.tmall.net":"tmall.com",d=a?"daily.taobao.net":"taobao.com",m=a?"yao.95095.daily.tmall.net":"yao.95095.com",u=a?"liangxinyao.daily.etao.net":"liangxinyao.com",h=a?"daily.alitrip.net":"alitrip.com";c&&(m="yao.95095.daily.etao.net"),s.superclass.constructor.call(t),t.set("_checkedMax",50),t.set("_numDanger",50);var f;f=r?o:i?m:n?u:l,t.set("host:fbuy","//{hostprefix}fbuy."+f),t.set("host:cart","//{hostprefix}cart."+l),t.set("host:buy","//{hostprefix}buy."+l),t.set("host:buyYY","//{hostprefix}buy."+m),t.set("host:buyHK","//{hostprefix}buy."+o),t.set("host:buyYYZY","//{hostprefix}buy."+u),t.set("host:buyTrip","//{hostprefix}buy."+h),t.set("api:num",(a?"//count.daily.taobao.net":"//count.taobao.com")+"/counter6"),t.set("api:list","{fbuy}/cart/mini/trailMiniCart.htm"),t.set("api:add","{fbuy}/cart/addCartItems.do"),t.set("api:del","{fbuy}/cart/mini/delMini.do"),t.set("api:update","{fbuy}/cart/mini/updateMini.do"),t.set("api:check","{fbuy}/cart/mini/checkMini.do"),t.set("api:sss","//{hostprefix}cart."+d+"/sss.htm"),t.set("api:bag","{fbuy}/auth/buyerRemoveReward.do"),t.set("api:bcart","{cart}/cart/myCart.htm"),t.set("api:buyTB","//{hostprefix}buy."+d+"/auction/order/confirm_order.htm"),t.set("api:buy","{buy}/order/confirmOrder.htm"),t.set("api:buyHK","{buyHK}/order/confirmOrder.htm"),t.set("api:buyYY","{buyYY}/order/confirm_order.htm"),t.set("api:buyYYZY","{buyYYZY}/order/confirm_order.htm"),t.set("api:buyTrip","{buyTrip}/order/confirmOrder.htm"),t.set("api:checkLogin","{buy}/login/buy.do"),t.set("api:checkLoginYY","{buyYY}/login/buy.do"),t.set("api:checkLoginYYZY","{buyYYZY}/login/buy.do"),t.set("api:checkLoginHK","{buyHK}/login/buy.do"),t.set("api:checkLoginTrip","{buy}/login/buy.do");var v=window.TB&&TB.Global&&TB.Global.setCartNum?TB.Global.setCartNum:function(){};t.on("numChange",function(){v(!this.get("_counterDown")&&!this.get("_countMax")&&this.getNum("total"))})}var o=function(){function e(){if(!a){var e=r.shift();e&&(a=!0,i.src="//gm.mmstat.com/"+e+(e.indexOf("?")>-1?"&":"?")+t.now())}}var a=!1,r=[],i=new Image;return window["_tmcr_"+t.now()]=i,i.onload=i.onerror=function(){a=!1,e()},function(t){t&&(r.push(t),e())}}();return KISSY.config({"packages":{"sd/data_sufei":{"base":"//g.alicdn.com/sd/data_sufei/1.3.6/sufei","ignorePackageNameInUri":!0,"charset":"utf8"}}}),KISSY.use("sd/data_sufei/sufei",function(t,e){}),t.extend(s,a),t.augment(s,i.Target||t.EventTarget,{"DATA":{},"NUM":{"total":0,"normal":0,"invalid":0,"primitive":!0},"TYPE":{"bundle":{"child":"main"},"main":{"parent":"bundle","child":"order"},"order":{"parent":"main"}},"setNum":function(e,a){var r={},i=!1;t.isPlainObject(e)?r=e:r[e]=a;var n=this.NUM;t.each(r,function(t,e){e in n&&(t!==n[e]&&(i=!0),n[e]=t)}),n.total=n.normal+n.invalid,n.total>=this.get("_numDanger")&&this.set("_countMax",!0),n.primitive&&(i=!0,n.primitive=!1),i&&this.fire("numChange"),this.fire("updateNum")},"getNum":function(e){var a=this.NUM;return e?a[e]:t.clone(a)},"numInit":function(){var e=this,a=!1,r=function(){if(!a){a=!0;var r=e.get("uid"),i="TCART_234_"+r+"_q",n=function(a){a=a||{},e.set("__totalCount__",a[i]);var r=t.isNumber(a[i]);r||e.set("_counterDown",!0),e.setNum({"normal":r?e.formatNum(a[i]):0,"invalid":0}),e.fire("numInit")};r?e.xhr({"api":"num","data":{"keys":i},"complete":n}):n()}};TB&&TB.Global&&TB.Global.loginStatusReady&&TB.Global.loginStatusReady(function(a){if(a.isLogin){e.set("_isLogin",!0);var i=t.later(r,5e3);TB.Global.memberInfoReady(function(t){i.cancel();var a=t.memberInfo;e.set("uid",a.cookies&&a.cookies.unb?a.cookies.unb.value:""),r()})}else e.set("uid",a.trackId),r()})},"dump":function(){window.console&&(window.console.log(this.getAttrVals()),window.console.log(this.NUM),window.console.log(this.DATA))},"getApi":function(e){var a=this;-1===e.indexOf(":")&&(e="api:"+e);var r=a.get(e);return r&&(t.each(["fbuy","buy","buyHK","cart","buyYY","buyYYZY","buyTrip"],function(t){r=r.replace("{"+t+"}",a.get("host:"+t)||"")}),"api:buyTrip"===e&&(r=r.replace("{hostprefix}","trip")),r=r.replace("{hostprefix}",a.get("host:prefix")||"")),r},"record":o,"add":function(e){function a(t){t.add=r.stringify(t.add);var e=s.get("_tb_token_");e&&(t._tb_token_=e)}function i(r){r?a(r):r=e.data,s.xhr({"api":"add","data":r,"success":function(t){s.set("totalSize",t.cartNum),s.setNum({"normal":t.cartNum,"invalid":0}),e.success(t)},"error":function(a){if(!(o>=l)){if("CsrfCheckFail"===a.errorCode&&a.tk)return o++,e.data._tb_token_=a.tk,s.set("_tb_token_",a.tk),i();if(a.errorCode||(a.errorCode="SERVER_BUSY",a.error="\u5ba2\u5b98\uff0c\u7f51\u7edc\u62e5\u5835\uff0c\u6dfb\u52a0\u8d2d\u7269\u8f66\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"),"BuyerNeedLogin"===a.errorCode){var d={"check":!1};r.proxyURL&&(d.proxyURL=r.proxyURL),c.show(function(){var c=r.getParams;return a.tk&&(e.data._tb_token_=a.tk,s.set("_tb_token_",a.tk)),t.isFunction(c)?void n.when(c(),function(t){return o++,i(t)}):(o++,i())},d)}else e.error(a)}}})}var s=this,o=0,l=1;e=s.mixParams(e),a(e.data),i()},"xhr":function(a){var r=this;a=t.merge({"data":{},"type":"get","success":function(){},"error":function(){},"complete":function(){},"wait":function(){},"needMerge":!1,"timeout":5},a);var i=r.getApi(a.api),n=t.later(function(){a.wait()},360),c=function(e){n.cancel(),a.responseData=e,r.onXhrResponse(a);var i=r.get("uid");"num"!==a.api||i||t.each(e,function(t,e){t<0&&r.record("tmalljy.2.5?action=tair-error")})},s=a.data,o=r.get("_tpId");o&&(s.tpId=o),a.data=s;var l=this.get("division");return l&&l.code&&(i+="?divisionCode="+l.code),"list"===a.api?void KISSY.use("sd/data_sufei/sufei",function(t,r){new e(r({"url":i,"data":s,"success":c,"dataType":"jsonp","crossDomain":!0,"cache":!1,"timeout":a.timeout},{"style":"taobao"}))}):void("get"===a.type?e({"url":i,"type":"get","scriptCharset":a.scriptCharset||"gbk","data":s,"dataType":"jsonp","complete":c,"timeout":a.timeout}):r.useProxy(function(t){t.post(i,s,c,a.timeout)}))},"onXhrResponse":function(e){var a=this,i=e.responseData;t.isPlainObject(i)||(i={"success":!1});var n,c=i.globalData;c&&(n=c.sss,a.set("_isLogin",c.login),!a.get("host:prefix")&&c.hostPrefix&&a.set("host:prefix",c.hostPrefix+"."),c.cartUrl&&a.set("api:bcart",c.cartUrl));try{n=n||r.parse(i.sss),t.isPlainObject(n)&&"quantity"in n&&t.getScript(a.getApi("sss")+"?quantity="+n.quantity+"&tk="+n.token+"&"+t.now())}catch(s){}i.success?(e.needMerge&&(a.set(c),a.merge(i.list)),c&&c.bundRela&&a.mergeBundleRelaPromo(c),e.success(i),e.needMerge&&a.calculate()):e.error(i),e.complete(i)},"formatNum":function(t){return t-=0,t>0?t:0},"read":function(t,e,a){if(!t)return null;var r;for(e=e.split("/");r=e.shift();){if(!(r in t))return a;t=t[r]}return t},"mixParams":function(e,a){return t.merge({"success":function(){},"error":function(){}},a,e)},"useProxy":function(e){var a=this;t.use("mui/minicart/proxy",function(t,r){r.init(a.getApi("host:fbuy")+"/cart/mini/proxy.htm",function(){}),e&&e(r)})}}),new s},{"requires":["ajax","base","json","event","promise","mui/minilogin/"]});KISSY.add("mui/minicart/util",function(t,e){var i={};return t.mix(i,{"toMoney":function(t,i){function a(){var t=!1;return/chaoshi/.test(location.host)&&(t=!0),window.g_config&&"chaoshi"===window.g_config.bizId&&(t=!0),t}if(a()&&e.get("#J_NavCart")&&!e.get("#J_NavCart_rmbStyle")){var r=e.create('<style id="J_NavCart_rmbStyle">.tm-mcTotal .tm-mcRmb{display:none;} .tm-mcTotalFee,.tm-mcOrder .tm-mcPrice{font-family: verdana, arial;}</style>');e.append(r,e.get("#J_NavCart"))}if(isNaN(parseFloat(t,10)))return t;"number"!=typeof t&&(t-=0);var n=100,c="&yen";return i&&(n=i.unitFactor||n,c=i.symbol||c),t/=n,isNaN(t)?"":c+t.toFixed(2)},"toWeight":function(t){return"number"!=typeof t&&(t-=0),t/=1e3,t||0},"toTxt":function(t){var i=document.createElement("div");return i.innerHTML=t,e.text(i).replace(/\s+/g,"")},"showLogin":function(e){t.use("mui/minilogin/",function(t,i){i.show(e)})}}),i},{"requires":["dom"]});